<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Dashboard</title><script src="https://cdn.tailwindcss.com"></script><script type="module" src="./js/auth.js"></script><script type="module" src="./js/books.js"></script><script type="module" src="./js/utils.js"></script><script type="module">
import { requireAuth, signOut } from './js/auth.js'
import { getBooks, addBook, updateBook, deleteBook } from './js/books.js'
import { showMessage, uploadCover } from './js/utils.js'
let user, books = []
await requireAuth().then(u=>user=u)
document.getElementById('libname').textContent = `${user.profile.libraries.school_name} - ${user.profile.libraries.name} (${user.profile.library_id_custom})`
document.getElementById('logout').onclick=()=>signOut().then(()=>location.href='index.html')
async function loadBooks(){ books = await getBooks(); const tbody=document.getElementById('booksBody'); tbody.innerHTML=''; books.forEach(b=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td class="p-3">${b.title}</td><td class="p-3">${b.author}</td><td class="p-3">${b.available_copies}/${b.total_copies}</td><td class="p-3"><button onclick="edit('${b.id}')" class="bg-yellow-500 text-white px-3 py-1 rounded">Edit</button> <button onclick="del('${b.id}')" class="bg-red-500 text-white px-3 py-1 rounded">Delete</button></td>`; tbody.appendChild(tr) })}
document.getElementById('bookForm').onsubmit=async(e)=>{e.preventDefault(); const file=document.getElementById('cover').files[0]; let cover=''; if(file){cover=await uploadCover(file)}; await addBook({title:document.getElementById('title').value,author:document.getElementById('author').value,isbn:document.getElementById('isbn').value,total_copies:+document.getElementById('copies').value,available_copies:+document.getElementById('copies').value,cover_image:cover}); showMessage('Book added'); loadBooks(); e.target.reset()}
window.edit=async(id)=>{const b=books.find(x=>x.id===id); const t=prompt('New title',b.title); if(t) await updateBook(id,{title:t}); loadBooks()}
window.del=async(id)=>{if(confirm('Delete book?')){await deleteBook(id); loadBooks()}}
loadBooks()
</script></head><body class="bg-gray-100"><nav class="bg-indigo-700 text-white p-4 flex justify-between items-center"><h1 id="libname" class="text-xl font-bold"></h1><button id="logout" class="bg-red-600 px-4 py-2 rounded">Logout</button></nav><div class="p-6 max-w-7xl mx-auto"><h2 class="text-3xl font-bold mb-6">Catalog Management</h2><div class="bg-white p-6 rounded-lg shadow mb-6"><form id="bookForm" class="grid grid-cols-1 md:grid-cols-2 gap-4"><input id="title" placeholder="Title" class="p-2 border rounded" required><input id="author" placeholder="Author" class="p-2 border rounded" required><input id="isbn" placeholder="ISBN" class="p-2 border rounded"><input id="copies" type="number" placeholder="Copies" class="p-2 border rounded" required><input id="cover" type="file" accept="image/*" class="p-2 border rounded"><button type="submit" class="bg-indigo-600 text-white py-2 rounded col-span-2">Add Book</button></form></div><table class="w-full bg-white rounded shadow"><thead class="bg-gray-200"><tr><th class="p-3 text-left">Title</th><th class="p-3 text-left">Author</th><th class="p-3 text-left">Stock</th><th class="p-3 text-left">Actions</th></tr></thead><tbody id="booksBody"></tbody></table><div class="mt-8 grid grid-cols-2 md:grid-cols-4 gap-4"><a href="members.html" class="bg-green-600 text-white text-center py-4 rounded-lg font-semibold">Members</a><a href="transactions.html" class="bg-purple-600 text-white text-center py-4 rounded-lg font-semibold">Issue / Return</a><a href="opac.html" class="bg-teal-600 text-white text-center py-4 rounded-lg font-semibold">Public OPAC</a></div></div></body></html>
